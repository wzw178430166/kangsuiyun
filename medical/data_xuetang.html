<!--<head></head><body></body>-->
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="topcolor" rgba="44.172.252.1">
<title set-lan="html:blood_sugar_data">血糖数据</title>
<link rel="stylesheet" type="text/css" href="/statics/css/app/appstyle.css">
<link rel="stylesheet" type="text/css" href="/statics/css/app/header_common.css">
<link rel="stylesheet" type="text/css" href="statics/css/fonts/font-awesome.min.css">
<script type="text/javascript" src="statics/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="statics/js/setFontSize.js"></script>
<script type="text/javascript" src="/statics/js/layer_mobile/layer.js"></script>
<script type="text/javascript" src="/statics/js/global.js"></script>
<script type="text/javascript" src="/statics/js/echarts_4.common.min.js"></script>
<script src="/statics/js/datePicker.js"></script>
<script type="text/javascript" src="/statics/languages/20181105/languages.js"></script>
<link rel="stylesheet" type="text/css" href="../statics/css/app/dangan.css">
</head>
<style>
body { background-color: #fff; }
.bg15_f2f2f2 { height: 15px; background-color: #f2f2f2; }
/**/

.data_box { width: 100%; overflow: hidden; background-color: #fff; padding-top: 15px; }
.data_box ul { width: 75%; overflow: hidden; border: 1px solid #5e90ef; border-radius: 3px; margin: 0 auto; }
.data_box li { width: 33.3%; float: left; height: 28px; line-height: 30px; text-align: center; color: #5e90ef; border-right: 1px solid #5e90ef; }
.data_box li:last-child { border-right: none; }
.data_box .active { background-color: #5e90ef; color: #fff; }
/**/

.data_ .time { width: 100%; height: 35px; line-height: 35px; padding: 0px 15%; overflow: hidden; text-align: center; color: #666; font-size: 1.2rem; background-color: #fff; padding-bottom: 15px; }
.data_ .time i { margin-left: 5px; }
.data_trend { width: 100%; height: 260px; background-color: #fff; }
/**/

.data_details { width: 100%; overflow: hidden; padding: 0px 3%; background-color: #fff; }
.data_details .title { width: 100%; height: 45px; line-height: 45px; border-bottom: 1px solid #e3e3e7; font-weight: bold; }
.data_details .title_r { color: #f94444; font-weight: bold; }
.data_details .title_r i { color: #1a1a1a; margin-right: 5px; }
.data_details_box { width: 100%; overflow: hidden; padding-bottom: 10px; }
.data_details_box li { border-bottom: 1px solid #e3e3e7; }
.data_details_box .data_details_line { width: 100%; overflow: hidden; padding: 10px 0px; }
.data_details_line .line_l { width: 35%; }
.data_details_line p { height: 20px; line-height: 20px; font-weight: bold; }
.data_details_line .line_l p:first-child { width: 50px; text-align: center; background-color: #2cacfc; color: #fff; border-radius: 3px; }
.data_details_line .line_l p:last-child { height: 25px; line-height: 25px; color: #666; font-size: 1.06rem; }
.data_details_line .line_m { width: 40%; position: relative; height: 40px; }
.data_details_line .line_m .p1 { position: relative; border-radius: 3px; color: #fff; margin: 0 auto; width: auto; text-align: center; float: left; }
.data_details_line .line_m .p2 { position: absolute; width: 61px; border-radius: 3px; color: #333; top: 80%; left: 50%; transform: translate(-50%, -50%); -webkit-transform: translate(-50%, -50%); text-align: center; }
.data_details_line .line_r { width: 25%; }
.data_details_line .line_r p { font-size: 1.2rem; height: 40px; line-height: 40px; color: #2cacfc; }
/**/

.details_total { width: 100%; overflow: hidden; }
.details_total .title { width: 100%; height: 40px; line-height: 40px; padding: 0px 5%; background-color: #f5f5f5; font-size: 1.1rem; border-bottom: 1px solid #fff; }
.details_total .title span { color: #666; }
.type_box { width: 100%; overflow: hidden; }
.accordion-menu li.open .dropdownlink { color: #666; }
.accordion-menu li.open .dropdownlink .fa-caret-down { -webkit-transform: rotate(180deg); transform: rotate(180deg); color: #b6b6b6; }
.dropdownlink { cursor: pointer; display: block; padding: 15px 5%; font-size: 1.1rem; color: #666; position: relative; -webkit-transition: all 0.4s ease-out; transition: all 0.4s ease-out; border-bottom: 1px solid #e4e4e4; background-color: #f5f5f5; }
.dropdownlink .fa-caret-down { position: absolute; top: 17px; right: 25px; color: #b6b6b6; }
.submenuItems { display: none; }
.submenuItems a { display: block; color: #727272; padding: 12px 12px 12px 45px; -webkit-transition: all 0.4s ease-out; transition: all 0.4s ease-out; font-size: 1rem; }
.submenuItems a:hover { color: #e66b27; }
.submenuItems .fa-star-o { margin-right: 15px; }
/**/

.submenuItems li { border-bottom: 1px solid #e3e3e7; }
.submenuItems li:nth-child(odd) { background-color: #fff; }
.submenuItems li:nth-child(even) { background-color: #fafafa; }
.submenuItems .data_details_line { width: 100%; overflow: hidden; padding: 10px; }
.data_details_line .line_l_ { width: 30%; }
.data_details_line .line_l_ p { height: 40px; line-height: 40px; color: #666; text-align: center; }
.data_details_line .line_m_ { width: 40%; position: relative; height: 40px; }
.data_details_line .line_m_ p { position: relative; width: auto !important; border-radius: 3px; color: #fff; text-align: center; float: left; }
.data_details_line .line_r_ { width: 80px; }
.data_details_line .line_r_ p { font-size: 1.2rem; height: 40px; line-height: 40px; color: #2cacfc; }
/**/

.h50 { height: 50px; }
.footer { width: 100%; height: 45px; background-color: #fff; padding: 5px 0px; border-top: 1px solid #cacaca; position: fixed; left: 0; bottom: 0; }
.footer li { width: 47%; margin-left: 2%; float: left; text-align: center; border-radius: 3px; height: 35px; line-height: 35px; font-weight: bold; }
.footer li:first-child { background-color: #68c4fd; color: #fff; }
.footer li:last-child { border: 1px solid #fea531; color: #fea531; }
.footer img { vertical-align: sub; margin-right: 5px; }
.footer .foot_l { width: 20px; height: 15px; }
.footer .foot_r { width: 17px; height: 19px; }
.header_box .midden {
    border-bottom: 1px solid #e6e6e6;
}
</style>

<body>
<div class="header_box"> <img src="/statics/images/goback_b.png" onClick="goback()" class="left">
  <p class="midden" set-lan="html:blood_sugar_data">血糖数据</p>
</div>
<div class="h50"></div>
<div class="data_box">
  <ul>
    <li class="active" set-lan="html:today">今天</li>
    <li set-lan="html:week">周趋势图</li>
    <li set-lan="html:detailed_data">详细数据</li>
  </ul>
</div>
<div class="data_">
  <p class="time"><!--<span class="fl" style="color:#5e90ef;">上一天</span>--><font id="start_t">2018-05-16</font><i class="fa fa-caret-down"></i><!--<span class="fr">下一天</span>--></p>
  <div class="bg15_f2f2f2"></div>
  <div class="data_trend" id="main3"></div>
  <div class="bg15_f2f2f2"></div>
  <div class="data_details">
    <p class="title"> <span class="title_l fl" set-lan="html:detailed_data_">详情数据</span> <span class="title_r fr"><i class="fa fa-circle-thin"></i><u set-lan="html:only_abnormal">仅显示异常数据</u></span> </p>
    <div class="data_details_box">
      <div style="color: #333;font-size: 1.06rem;text-align: center;display: none;" onClick="goo('/equipment/equipment_list.html')" id="if_fo"> <img src="/statics/images/back_no_data.png" style="height: 15rem;"/> </div>
      <ul>
        <div class="template" id="template1">
          <li>
            <div class="data_details_line">
              <div class="line_l fl">
                <p>血糖仪</p>
                <p class="dtime">07月28日 14:00</p>
              </div>
              <div class="line_m fl">
                <p class="p1 info">偏高</p>
              </div>
              <div class="line_r fr">
                <p>血糖： <span class="today_value_t">9.3</span> </p>
              </div>
            </div>
          </li>
        </div>
      </ul>
    </div>
  </div>
</div>
<div class="data_">
  <div class="data_trend" id="main2" style="-webkit-transform: rotate(90deg);-moz-transform: rotate(90deg);filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);margin-top: 15%;"></div>
</div>
<div class="data_" style="background-color:#fff;"> 
  
  <!--<div style="background-color:#fff; height:35px;"></div>-->
  
  <div class="details_total">
    <p class="time"><font id="start_m">2018-01</font><i class="fa fa-caret-down"></i></p>
    <p class="title"> <span class="fl"><u set-lan="html:month_test">本月检测数</u>：<i style="color:#2cacfc">0次</i></span> <span class="fr"><u set-lan="html:wave_times">波动次数</u>：<i style="color:#f94444;">0次</i></span> </p>
    <div class="type_box">
      <ul class="accordion-menu">
        <div id="template2" class="template">
          <li class="aitem">
            <div class="dropdownlink"> 2018-03-21 <i class="fa fa-caret-down fa-lg" aria-hidden="true"></i> </div>
            <ul class="submenuItems">
              <li>
                <div class="data_details_line">
                  <div class="line_l_ fl time">
                    <p>14:00</p>
                  </div>
                  <div class="line_m_ fl">
                    <p style="background-color:#fc6e71;" class="info">偏高</p>
                  </div>
                  <div class="line_r fr">
                    <p>血糖：9.3</p>
                  </div>
                </div>
              </li>
            </ul>
          </li>
        </div>
      </ul>
    </div>
  </div>
</div>
<div class="h50"></div>
<div class="footer">
  <ul>
    <li><img src="statics/images/data_foot_l.png" class="foot_l"><i set-lan="html:send_to_friends">发送给亲友</i></li>
    <li><img src="statics/images/data_foot_r.png" class="foot_r"><i set-lan="html:consult_a_doctor">向医生咨询</i></li>
  </ul>
</div>
</body>
</html>
<script> 

$('.data_box ul li').click(function(){

    $(this).addClass('active').siblings().removeClass('active');

	var _index = $(this).index();

    $('.data_').eq(_index).show().siblings('.data_').hide();

    });

$('.data_').eq(0).show().siblings('.data_').hide();

var calendar_s = new datePicker();

calendar_s.init({

    'trigger': '#start_t', /*按钮选择器，用于触发弹出插件*/

    'type': 'date',/*模式：date日期；datetime日期时间；time时间；ym年月；*/

    'minDate':'1970-01-01',/*最小日期*/

    'maxDate':'2520-12-31',/*最大日期*/

    'onSubmit':function(){/*确认时触发事件*/

        var theSelectData = calendar_s.value;

		$('#start_t').text(theSelectData);

		//get_today();

		get_data();

    },

    'onClose':function(){/*取消时触发事件*/

    }

});

var calendar_m = new datePicker();

calendar_m.init({

    'trigger': '#start_m', /*按钮选择器，用于触发弹出插件*/

    'type': 'ym',/*模式：date日期；datetime日期时间；time时间；ym年月；*/

    'minDate':'1970-01-01',/*最小日期*/

    'maxDate':'2520-12-31',/*最大日期*/

    'onSubmit':function(){/*确认时触发事件*/

        var theSelectData = calendar_m.value;

		$('#start_t').text(theSelectData);
		$('#start_t').text(theSelectData);
		get_data();
		//get_detail();

    },

    'onClose':function(){/*取消时触发事件*/

    }

});

</script>
<script>

function Mytime(){

  this.gettimestamp = function(timestamp){

    var date;

    if(timestamp){

      if(timestamp.length==10){ timestamp *= 1000; }

      date = new Date(timestamp);

    }else{

      date = new Date();

    }

    return date

  }

  this.date = function(format,timestamp,zeroize) { 

    Ndate = this.gettimestamp(timestamp);

    Y = Ndate.getFullYear();

    M = (Ndate.getMonth() + 1 < 10 ? '0' + (Ndate.getMonth() + 1) : Ndate.getMonth() + 1);

    D = Ndate.getDate() < 10 ? '0' + Ndate.getDate() : Ndate.getDate();

    h = Ndate.getHours() < 10 ? '0' + Ndate.getHours() : Ndate.getHours(); 

    m = Ndate.getMinutes() < 10 ? '0' + Ndate.getMinutes() : Ndate.getMinutes();

    s = Ndate.getSeconds(); 



    format = format.replace('Y',Y);

    format = format.replace('M',M);

    format = format.replace('D',D);

    format = format.replace('h',h);

    format = format.replace('i',m);

    format = format.replace('s',s);

    return format;

  }

  this.getWeek =function(timestamp){ 

    Ndate = this.gettimestamp(timestamp);

    var re = {}; 

    re.WeekFirstDay=new Date(new Date(Ndate-(Ndate.getDay()-1)*86400000));     

    re.WeekLastDay=new Date((re.WeekFirstDay/1000+6*86400)*1000);     

    return re;

  }

}

function showWeekFirstDay()     

{     

    var Nowdate=new Date();     

    var WeekFirstDay=new Date(Nowdate-(Nowdate.getDay()-1)*86400000);     

    M=Number(WeekFirstDay.getMonth())+1     

    return WeekFirstDay.getFullYear()+"-"+M+"-"+WeekFirstDay.getDate();     

}

</script>
<script>

var tt = 0;

var page = 0;

var offsetVal = 0;

var userid = getUrlParam('to_uid')? getUrlParam('to_uid'):0;

var mt = new Mytime(); 



$(function(){

	$('#main2').height(window.screen.width - 50);

	$('#main2').width(window.screen.width);

  	setLeftMenuAnimate();

  	

	$('#start_t').text(getNowFormatDate());

	$('#start_m').text(getNowFormatDate(1));



	 get_data();

});  

function get_data(){

	var msg = layer.open({

				type: 2,

				content: '加载中...'

			});

	$.ajax({

		url:'/?m=data&c=bg&a=getMonth',

		type:'POST', 

		data:'_userid='+userid+'&date_time='+$('#start_t').text(),

		dataType:'json', 

		success:function(da){ 

			 layer.close(msg);

       setDay(da);

       setWeed(da);

       get_detail(da);
		StranBody();
		},

	})

} 



function getcolor(state){

  var color;

  switch(state){

      case 1: color = 'rgb(16, 202, 56)'; break;

      case 2: color = 'rgb(245, 164, 49)'; break;

      case 3: color = 'rgb(249, 68, 68)'; break;

  }

  return color;

}

function setDay(da){
  var a = $('#template1');

  var t = false;

  var ech_time = new Array(),ech_data_value = new Array();

  for (var ii in da) {

    das = da[ii].data_json;

    for (var i in das) {

      if(das[i].today_value_t 

         && mt.date('Y-M-D',das[i].add_time) == $('#start_t').text()

        )

      {

        t = true;

        ech_time.push(i);

        ech_data_value.push( das[i].today_value_t ); 

        //

        $(a).find('.dtime').html(mt.date('Y-M-D h:i',das[i].add_time)); 

        $(a).find('.today_value_t').html(das[i].today_value_t);

        $(a).find('.info').html('');

        if(das[i].info){

             $(a).find('.info').html('&nbsp;'+das[i].info+'&nbsp;');

        }

        color = getcolor( Number(das[i].state) );

       

        $(a).find('.info').css('background-color',color);

        $(a).find('li').attr('class','i_'+ das[i].add_time);



        try { $(a).find('.testtype').html(das[i].testtype); } catch (e) { }



        $(a).after($(a).html());

      }

    }

  }

  if(!t){

    ech_time.push('没有检测数据');

    ech_time.push('-');

    ech_data_value.push('2');

    ech_data_value.push('2');

    $('#if_fo').show();

  } 

  get_bg_ech = new Get_bg_ech(ech_time,ech_data_value,'main3');

  get_bg_ech.set();

}

function setWeed(da){

  var t = false;

  var w ;

  var ech_time = new Array(),ech_data_value = new Array();

  for (var ii in da) {

    das = da[ii].data_json;

    for (var i in das) {

      w = mt.getWeek(das[i].add_time);

      nowday = mt.date('YMD'); 

      console.log(mt.date('YMD',w.WeekFirstDay)+'/'+mt.date('YMD',w.WeekLastDay)+'<>'+nowday);

      if(das[i].today_value_t 

          && Number(nowday) >= Number(mt.date('YMD',w.WeekFirstDay))

          && Number(nowday) <= Number(mt.date('YMD',w.WeekLastDay))

        )

      {

        console.log( das[i].today_value_t);

        t = true;

        ech_time.push(i);

        ech_data_value.push( das[i].today_value_t ); 

      }

  }

  }

  if(!t){

    ech_time.push('没有检测数据');

    ech_time.push('-');

    ech_data_value.push('2');

    ech_data_value.push('2');

  } 

    

  get_bg_ech = new Get_bg_ech(ech_time,ech_data_value,'main2');

  get_bg_ech.set();

}

var template2_a = document.createElement('div');

var template2_b = document.createElement('div');

template2_a.innerHTML = $('#template2').html();

$(template2_a).find('.submenuItems li').each(function(){ this.remove(); });

template2_b.innerHTML = $('.submenuItems').html();



function get_detail(da){
$('.accordion-menu').html('');

  if(da && da[0] && da[0].data_json) da = da[0].data_json;

  for(var i in da){

    if( !document.getElementById('a_'+ da[i].add_date) ){
$('#if_fo').hide();
      $(template2_a).find('.dropdownlink').html( mt.date('Y-M-D',das[i].add_time) );

      $(template2_a).find('.submenuItems').attr('id', 'a_'+ da[i].add_date );
		

      $('.accordion-menu').prepend( $(template2_a).html() );

    }

    $(template2_b).find('.time').html( mt.date('h:i',da[i].add_time) );

    $(template2_b).find('.info').html( '&nbsp;'+da[i].info+'&nbsp;' );

       

    $(template2_b).find('.info').css('background-color', getcolor( Number(das[i].state)) );
$(template2_b).find('.line_r p').text(da[i].today_value_t);
    $('#a_'+ da[i].add_date).prepend( $(template2_b).html() );

  }

  //setLeftMenuAnimate();

  $('.submenuItems').show();

}  

</script>
<script>

function Get_bg_ech(ech_time,ech_data_value,id){

	// 基于准备好的dom，初始化echarts实例

  this.ech_time = ech_time;

  this.ech_data_value = ech_data_value;

  this.id = id;

  this.set = function(){

    _this = this;

    $('#'+_this.id).width(window.screen.width);

    var myChart = echarts.init(document.getElementById(_this.id));

    // 指定图表的配置项和数据

    var option = {

      title: {

        text: '今日趋势图',

        top: '5%',

        textStyle:{	fontSize: 16 }},

      tooltip : {

        trigger: 'axis',

        axisPointer: {

          type: 'cross',

          label: { backgroundColor: '#6a7985' }

        }},

      legend: {

        data:['血糖'],

        top: '5%'

      },

      toolbox: {

        feature: { saveAsImage: {} },

        top: '5%'

      },

      grid: {

        left: '3%',

        right: '4%',

        bottom: '3%',

        containLabel: true

      },

      xAxis : [

        {

          type : 'category',

          boundaryGap : false,

          data : _this.ech_time

        }

      ],

      yAxis : [

        {

          type : 'value'

        }

      ],

      series : [ 

        {

          name:'血糖',

          type:'line',

          stack: '总量',

          areaStyle: {normal: {}},

          itemStyle : {normal: {

            color:'#2982BC',//折线点颜色

            lineStyle:{

              color:'#2982BC'//折线颜色

            },

              label : {position: 'top',show: true}//显示数值

          }},

          data:_this.ech_data_value 

        }

      ]

    };

    // 使用刚指定的配置项和数据显示图表。

    myChart.setOption(option); 

  }

}

</script>
<script>

function setLeftMenuAnimate(){

  var Accordion = function(el, multiple) {

    this.el = el || {};

    // more then one submenu open?

    this.multiple = multiple || false;

    

    var dropdownlink = this.el.find('.dropdownlink');

    dropdownlink.on('click',{ el: this.el, multiple: this.multiple },this.dropdown);

  };

  

  Accordion.prototype.dropdown = function(e) {

    var $el = e.data.el,

        $this = $(this),

        //this is the ul.submenuItems

        $next = $this.next();

    

    $next.slideToggle();

    $this.parent().toggleClass('open');

    

    if(!e.data.multiple) {

      //show only one menu at the same time

      $el.find('.submenuItems').not($next).slideUp().parent().removeClass('open');

    }

  }

  

  var accordion = new Accordion($('.accordion-menu'), false);

}

function getNowFormatDate(a){

    var date = new Date();

    var seperator1 = "-";

    var year = date.getFullYear();

    var month = date.getMonth() + 1;

    var strDate = date.getDate();

    if(month >= 1 && month <= 9){

        month = "0" + month;

    }

    if(strDate >= 0 && strDate <= 9){

        strDate = "0" + strDate;

    }

    var currentdate = year + seperator1 + month + seperator1 + strDate;

    if(a == 1) return year + seperator1 + month;

	return currentdate;

}





</script>