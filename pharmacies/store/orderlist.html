<!DOCTYPE html>
<html lang="cn">
<head>
<meta charset="UTF-8">
<meta name="viewport"
        content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<link rel="stylesheet" type="text/css" href="/statics/css/app/appstyle.css">
<link rel="stylesheet" type="text/css" href="/pharmacies/store/css/header_common.css?v=124">
<link rel="stylesheet" type="text/css" href="/pharmacies/store/css/left_.css?v=126">
<link rel="stylesheet" type="text/css" href="/pharmacies/store/css/index.css">
<link rel="stylesheet" href="/statics/admin/common/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/statics/dataManage/css/bootstrap.css">
<script type="text/javascript" src="/statics/js/setFontSize.js"></script>
<script type="text/javascript" src="/statics/js/laydate/laydate.js"></script>
<script type="text/javascript" src="/statics/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/statics/js/global.js"></script>
<script type="text/javascript" src="/statics/admin/common/layui/layui.all.js"></script>
<link id="layuicss-laydate" rel="stylesheet" href="https://www.519ksy.com/statics/admin/common/layui/css/modules/laydate/default/laydate.css?v=5.0.9" media="all">
<script charset="utf-8" src="/statics/admin/common/js/colResizable.js"></script>
<title>订单列表</title>
<style>
 .query-btn .btn-item {
    margin-left: 0px;
}
.query-btn .btn-item {
    height: auto;
    min-height: 26px;
}
.query-btn .btn-item {
    height: auto;
    min-height: 26px;
    text-align: center;
}
.gethome{    
    width: 97%;
    height: .7rem;
    line-height: .7rem;
    margin: .3rem auto 0 auto;}
.gethome svg{float:right;width: .5rem;height: .5rem;vertical-align: middle;}
.gethome span{float: right;
    margin-left: .05rem;vertical-align: middle;
    color: #836be0;}
    .element-date svg{    width: 30px;
    height: 30px;
    position: relative;
    left: -30px;}
</style>
</head>
<body>
   <div class="outdiv">
      <div class="left" id="left">
         <!--#include file="left.html"-->
      </div>
       <div class="right_conter">
           <div class="header_box" id="header">
        <!--#include file="header.html"-->   
           </div>
           <div class="h8vh"></div>
           <div style="width: auto;margin: 0;">
            <div class="gethome">
              <span>处方列表</span>
              <svg t="1607394397077" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1709" width="48" height="48"><path d="M422.63 891.821V623.712h178.74v268.109h223.424V534.342h134.054L512 132.179 65.152 534.342h134.054V891.82H422.63z" p-id="1710" fill="#707070"></path></svg>
            </div>
            <div class="query-module">
                <div class="query-form">
                  <div class="form-item"> <font>处方单号</font>
                    <div class="element">
                      <div class="element-text">
                        <input type="text" id="k" value="">
                      </div>
                    </div>
                  </div>
                  <div class="form-item"> <font>关键词</font>
                    <div class="element">
                      <div class="element-text">
                        <input type="text" id="userid" value="">
                      </div>
                    </div>
                  </div>
                  <div class="form-item"> <font>时间范围</font>
                    <div class="element">
                      <div class="element-date" style="display: flex;align-items: center;">
                        <input type="text" id="st" value="" lay-key="2">
                        <svg t="1607933029386" class="icon" viewBox="0 0 1219 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1232" width="48" height="48"><path d="M901.261256 252.731379h-568.966822c-11.309806 0-20.474755 9.412979-20.474755 21.025708V780.626709c0 11.614763 9.166981 21.025709 20.474755 21.025709h568.964789c11.307773 0 20.468656-9.410946 20.468655-21.025709V273.757087c0.008132-11.61273-9.162915-21.025709-20.466622-21.025708z m0.14028 517.980189c0 5.861257-4.529615 10.61044-10.118445 10.610441H342.268532c-5.588829 0-10.116411-4.749184-10.116411-10.610441V283.666129c0-5.855158 4.529615-10.604341 10.116411-10.604342h549.014559c5.588829 0 10.118444 4.749184 10.118445 10.604342v487.045439z" p-id="1233" fill="#bfbfbf"></path><path d="M474.629659 201.903323h20.330409v118.593374h-20.330409zM738.589522 201.903323h20.330409v118.593374h-20.330409zM331.385664 422.150775h570.270002v20.330408H331.385664z" p-id="1234" fill="#bfbfbf"></path></svg>
                        <span class="gap">到</span>
                        <input type="text" id="et" value="" lay-key="1">
                        <svg t="1607933029386" class="icon" viewBox="0 0 1219 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1232" width="48" height="48"><path d="M901.261256 252.731379h-568.966822c-11.309806 0-20.474755 9.412979-20.474755 21.025708V780.626709c0 11.614763 9.166981 21.025709 20.474755 21.025709h568.964789c11.307773 0 20.468656-9.410946 20.468655-21.025709V273.757087c0.008132-11.61273-9.162915-21.025709-20.466622-21.025708z m0.14028 517.980189c0 5.861257-4.529615 10.61044-10.118445 10.610441H342.268532c-5.588829 0-10.116411-4.749184-10.116411-10.610441V283.666129c0-5.855158 4.529615-10.604341 10.116411-10.604342h549.014559c5.588829 0 10.118444 4.749184 10.118445 10.604342v487.045439z" p-id="1233" fill="#bfbfbf"></path><path d="M474.629659 201.903323h20.330409v118.593374h-20.330409zM738.589522 201.903323h20.330409v118.593374h-20.330409zM331.385664 422.150775h570.270002v20.330408H331.385664z" p-id="1234" fill="#bfbfbf"></path></svg>
                      </div>
                    </div>
                  </div>
                  <div class="form-item"> <font>状态</font>
                    <div class="element">
                      <div class="element-select">
                        <select id="status">
                            <option value="">全部</option>
                          <option value="waitPay">0</option>
                          <option value="success">1</option>
                          <option value="close">2</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="query-btn">
                  <div class="btn-item"> <a class="btn-sais" id="J_query" style="padding-left: 15px;">
                    <svg style="width:20px;height:20px;vertical-align: middle;" t="1607394598323" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2669" width="48" height="48"><path d="M874.666667 814.933333l-209.066667-209.066666C704 554.666667 725.333333 494.933333 725.333333 426.666667c0-166.4-132.266667-298.666667-298.666666-298.666667s-298.666667 132.266667-298.666667 298.666667 132.266667 298.666667 298.666667 298.666666c68.266667 0 128-21.333333 179.2-59.733333l209.066666 209.066667c17.066667 17.066667 42.666667 17.066667 59.733334 0s17.066667-42.666667 0-59.733334zM426.666667 640c-119.466667 0-213.333333-93.866667-213.333334-213.333333s93.866667-213.333333 213.333334-213.333334 213.333333 93.866667 213.333333 213.333334-93.866667 213.333333-213.333333 213.333333z" fill="#ffffff" p-id="2670"></path></svg>
                    筛选
                    
                    </a> <a href="#" class="btn-rest" style="margin-left: 10px;">重置</a>
                    <span class="btn-adds">
                        添加
                        <svg t="1607343289035" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1155" data-spm-anchor-id="a313x.7781069.0.i6" width="48" height="48"><path d="M512 981.333333c259.2 0 469.333333-210.133333 469.333333-469.333333S771.2 42.666667 512 42.666667 42.666667 252.8 42.666667 512s210.133333 469.333333 469.333333 469.333333z m0-42.666666C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z" p-id="1156" fill="#e6e6e6" data-spm-anchor-id="a313x.7781069.0.i7" class=""></path><path d="M298.666667 533.333333h426.666666a21.333333 21.333333 0 1 0 0-42.666666H298.666667a21.333333 21.333333 0 0 0 0 42.666666z" p-id="1157" fill="#707070" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path><path d="M490.666667 298.666667v426.666666a21.333333 21.333333 0 1 0 42.666666 0V298.666667a21.333333 21.333333 0 1 0-42.666666 0z" p-id="1158" fill="#707070" data-spm-anchor-id="a313x.7781069.0.i1" class="selected"></path></svg>
                    </span>
                </div>
             
                </div>
              </div>
              <div class="data-content">
                <div class="tb-container">
                    <table class="table">
                        <caption class="caption">订单列表</caption>
                        <thead>
                            <tr align="center">
                               <th>
                               <strong class="tb-head cell-check" data-val="check">
                               <input type="checkbox" id="J_sel_all" style="width: 15px;height: 15px;border:1px solid #666">
                               </strong>
                               </th>
                               <th><strong class="tb-head cell-orderid" data-val="orderid">处方单号</strong></th>
                               <th><strong class="tb-head cell-username" data-val="username">申请用户</strong></th>
                               <th><strong class="tb-head cell-product" data-val="product">申请日期</strong></th>
                               <th><strong class="tb-head cell-amount" data-val="amount">药品数量</strong></th>
                               <th><strong class="tb-head cell-pay_channel" data-val="pay_channel">药品金额</strong></th>
                               <th><strong class="tb-head cell-pay_amount" data-val="pay_amount">医生</strong></th>
                               <th><strong class="tb-head cell-status" data-val="status">医生接入点</strong></th>
                               <th><strong class="tb-head cell-createtime" data-val="createtime">审核状态</strong></th>
                               <th><strong class="tb-head cell-operate" data-val="operate">操作</strong></th>
                           </tr>
                         </thead>
                       <tbody>
                          <tr align="center">
                              <td>
                                <strong class="tb-head cell-check" data-val="check">
                                    <input type="checkbox" id="J_sel_all" style="width: 15px;height: 15px;border:1px solid #666">
                                    </strong>
                              </td>
                              <td>1113454654654</td>
                              <td>张三</td>
                              <td>2020-02-03</td>
                              <td>2</td>
                              <td>233.5</td>
                              <td>张主卧</td>
                              <td>春雨</td>
                              <td><span style="color: #48a54b;">已审核</span></td>
                             <td>
                                <a href="/pharmacies/store/pharmacy_see.html">查看</a>
                                <a href="/pharmacies/store/distribution.html">配药</a>
                                <a href="#">删除</a>
                             </td>
                          </tr>
                          <tr align="center">
                            <td>
                                <strong class="tb-head cell-check" data-val="check">
                                    <input type="checkbox" id="J_sel_all" style="width: 15px;height: 15px;border:1px solid #666">
                                    </strong>
                            </td>
                             <td>5113454654654</td>
                             <td>张三</td>
                             <td>2020-08-03</td>
                             <td>2</td>
                             <td>233.5</td>
                             <td>张主卧</td>
                             <td>春雨</td>
                             <td><span style="color: #ff9d38;">未审核</span></td>
                             <td>
                                 <a href="/pharmacies/store/payment.html">查看</a>
                                 <a href="/pharmacies/store/review_p.html">药师审核</a>
                                 <a href="#">删除</a>
                             </td>
                          </tr>
                       </tbody>
                    </table>
                  <!-- <table class="table table-bordered table-hover table-striped" id="rstb">
                   <thead>
                       <tr align="center">
                          <th><strong class="tb-head cell-check" data-val="check">
                          <input type="checkbox" id="J_sel_all">
                          </strong></th>
                          <th><strong class="tb-head cell-orderid" data-val="orderid">处方单号</strong></th>
                          <th><strong class="tb-head cell-username" data-val="username">申请用户</strong></th>
                          <th><strong class="tb-head cell-product" data-val="product">申请日期</strong></th>
                          <th><strong class="tb-head cell-amount" data-val="amount">药品数量</strong></th>
                          <th><strong class="tb-head cell-pay_channel" data-val="pay_channel">药品金额</strong></th>
                          <th><strong class="tb-head cell-pay_amount" data-val="pay_amount">医生</strong></th>
                          <th><strong class="tb-head cell-status" data-val="status">医生接入点</strong></th>
                          <th><strong class="tb-head cell-createtime" data-val="createtime">审核状态</strong></th>
                          <th><strong class="tb-head cell-operate" data-val="operate">操作</strong></th>
                      </tr>
                    </thead>
                    <tbody id="datas">
                    </tbody>
                  </table> -->
                </div>
                <div class="inner-page" id="innerPage"></div>
              </div>


           </div>
       </div>
   </div>   
   <script>
    var page = 1;
    checkLogin("golink");
    $(function(){
        //getleft();
        //gethearder();
        var date = new Date();
        $('#st').val(date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate());
        $('#et').val(date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate());
        getData();
        var screenHeight = $(window).height();
        $('.first-container').css({height: screenHeight - 93});
        var tbWidth = $(window).width() - 245;
        $(".tb-container").css({width:tbWidth});
        $("#rstb").css({maxWidth:tbWidth});
        $("#rstb").colResizable({
            resizeMode: 'overflow',
            //minWidth: 15,
            //headerOnly: true,
            //dragCursor: '',
            //liveDrag: true,
            //draggingClass: 'tb-cell',
            onResize: function(e,data){
                //console.log($(e.currentTarget));
                //$('.tb-cell').width();
            }
        });	
        laydate.render({
          elem: '#et'
          ,format: 'yyyy-MM-dd'
          ,done: function(value,date,endDate){
              et = value;
          }
        });
        laydate.render({
          elem: '#st'
          ,format: 'yyyy-MM-dd'
          ,done: function(value,date,endDate){
              st = value;
          }
        });
        $('#J_query').on('click', function(){
            page = 1;
            getData();
        });
    });
    function getData(){
        var url = '/?m=circleN&c=news&a=getNewsFy';
       
        var k = $.trim($('#k').val());
        if (k) url += '&k='+k;
        var st = $.trim($('#st').val());
        var et = $.trim($('#et').val());
        if (st&&et) url += '&st='+st+'&et='+et;
        var status = $.trim($('#status').val());
        if (status) url += '&status='+status;
        if (page > 1) url += '&page='+page;
        var index = layer.load(2,{time:3000});
        $.ajax({
            url: url,
            type: "GET",
            dataType: "JSON",
            success: function(data){
                console.log(66666);
                console.log(data);
                layer.close(index);
                var html = '';
                var pageCount = 0;
                if (data.status==1) {
                    var datas = data.data.datas;
                    var member = data.data.member;
                    pageCount = data.data.pageCount;
                    for(var i in datas){
                        var info = datas[i];
                        var product = '';
                        switch(info.type){
                            case 'recharge':
                                product = '余额充值';
                                break;
                        }
                        var pay_channel = '';
                        switch(info.pay_channel){
                            case 'wechat':
                                pay_channel = '微信支付';
                                break;
                            case 'alipay':
                                pay_channel = '支付宝支付';
                                break;
                        }
                        var status = '';
                        var operate = '<a href="javascript:;" class="operate-btn btn-del" data-val="'+info.orderid+'">删除</a>';
                        switch(info.status){
                            case 'waitPay':
                                status = '待付款';
                                operate = '<a href="javascript:;" class="operate-btn btn-close" data-val="'+info.orderid+'">取消</a>';
                                break;
                            case 'success':
                                status = '已付款';
                                break;
                            case 'close':
                                status = '已取消';
                                break;
                        }
                        var _member = {};
                        if (member&&member[info.userid]) {
                            _member = member[info.userid];
                        } else {
                            _member = {"username":"","nickname":""};
                        }
                        html += '<tr align="center"><td><div class="tb-cell cell-check"><input type="checkbox" name="ids[]" value="'+info.out_trade_no+'"></div></td><td><div class="tb-cell cell-orderid">'+info.orderid+'</div></td><td><div class="tb-cell cell-username">'+_member.username+(_member.nickname?'('+_member.nickname+')':'')+'</div></td><td><div class="tb-cell cell-product">'+product+'</div></td><td><div class="tb-cell cell-amount">'+info.amount+'</div></td><td><div class="tb-cell cell-pay_channel">'+pay_channel+'</div></td><td><div class="tb-cell cell-pay_amount">'+info.pay_amount+'</div></td><td><div class="tb-cell cell-status">'+status+'</div></td><td><div class="tb-cell cell-createtime">'+info.createtime+'</div></td><td><div class="tb-cell cell-operate">'+operate+'</div></td></tr>';
                    }
                } else {
                    html += '<tr align="center"><td colspan="'+($('.tb-head').length)+'">暂无数据</td></tr>';
                }
                $('#datas').html(html);
                initWidth();
                initOperate();
                if (page == 1) initPage(pageCount);
            }
        });
    }
    function initOperate(){
        $('.btn-close').unbind('click');
        var _item = $('.btn-close');
        _item.each(function(i) {
            $(_item[i]).on('click',function(){
                var orderid = $(this).attr('data-val');
                layer.confirm('确定要取消订单?',{btn:["确定","取消"]},function(){
                    doOrderStatus(orderid,'close');
                });
            });
            
        });
        $('.btn-del').unbind('click');
        var _item2 = $('.btn-del');
        _item2.each(function(i) {
            var orderid = $(this).attr('data-val');
            $(_item2[i]).on('click',function(){
                layer.confirm('确定要删除订单?',{btn:["确定","取消"]},function(){
                    doOrderStatus(orderid,'delete');
                });
            });
            
        });
    }
    function doOrderStatus(orderid,status){
        if (!orderid || !status) {
            layer.msg('订单异常');
            return;
        }
        var url = '/?m=dataManage&c=workOrder&a=doOrderRechargeState&ajax=1';
        $.ajax({
            url: url,
            type: "POST",
            dataType: "JSON",
            data: {dosubmit:1,orderid:orderid,status:status},
            success: function(data){
                layer.msg(data.erro);
                validateAuth(data.status);
                if (data.status == 1) getData();
            }
        });
    }
    function initWidth(){
        var _item = $('.tb-head');
        _item.each(function(i) {
            var w = $(this).width();
            var v = $(this).attr('data-val');
            $('.cell-'+v).width(w);
        });
    }
    function initPage(pageCount) {
        layui.use('laypage', function(){
            var laypage = layui.laypage;
            laypage.render({
                elem: 'innerPage' //注意，这里的 test1 是 ID，不用加 # 号
                ,count: pageCount //数据总数，从服务端得到
                //,limit: 10
                ,layout: ['prev', 'page','next', 'skip','count']//['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                ,prev: '<i class="icon-arrow arrow-l"></i>'
                ,next: '<i class="icon-arrow arrow-r"></i>'
                ,hash: 'page'//页面载入时就定位到指定页
                ,theme: '#234686'
                ,jump: function(obj, first){
                    //首次不执行
                    if (!first) {
                        //console.log(obj);
                        page = parseInt(obj.curr);
                        getData();
                    }
                }
            });
        });
    }
    function gethearder() {
            $('#header').load('/pharmacies/store/header.html', function () {
            });
        }
        function getleft(){
            $('#left').load('/pharmacies/store/left.html', function () {
            });
        }
    </script>
</body>
</html>