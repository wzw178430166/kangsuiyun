<!DOCTYPE html>
<html lang="cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <link rel="stylesheet" type="text/css" href="/statics/css/app/appstyle.css">
    <link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/header_common.css?v=129">
    <link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/left_.css?v=127">
    <link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/index.css?v=122">
    <link rel="stylesheet" href="/statics/admin/common/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/statics/dataManage/css/bootstrap.css">
    <script type="text/javascript" src="/statics/js/setFontSize.js"></script>
    <script type="text/javascript" src="/statics/js/laydate/laydate.js"></script>
    <script type="text/javascript" src="/statics/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/statics/js/global.js"></script>
    <script type="text/javascript" src="/statics/admin/common/layui/layui.all.js"></script>
    <link id="layuicss-laydate" rel="stylesheet"
        href="https://www.519ksy.com/statics/admin/common/layui/css/modules/laydate/default/laydate.css?v=5.0.9"
        media="all">
    <script charset="utf-8" src="/statics/admin/common/js/colResizable.js"></script>
    <title>问诊列表</title>
    <style>
        .query-btn .btn-item {
            margin-left: 0px;
        }

        .query-btn .btn-item {
            height: auto;
            min-height: 26px;
        }

        .query-btn .btn-item {
            height: auto;
            min-height: 26px;
            text-align: center;
        }

        .mstboxgg {
            display: flex;
            width: 97%;
            margin: 0 auto;
            justify-content: space-between;
        }

        .lefts_boxf {
            display: flex;
        }

        .gethome {
            width: 30%;
            height: .8rem;
            line-height: .8rem;
            float: right;
            margin: .3rem .5rem 0 0;
        }

        .gethome svg {
            float: right;
            width: .5rem;
            height: .5rem;
            vertical-align: middle;
            margin-top: .05rem;
        }

        .gethome span.so2 {
            float: right;
            margin-left: .05rem;
            vertical-align: middle;
            color: #836be0;
        }

        .gethome span.so1 {
            float: right;
            margin-left: .05rem;
            vertical-align: middle;
            color: #000;
        }

        .back_goo {
            width: 2rem;
            height: 1.1rem;
            line-height: 1.1rem;
            border: 1px solid #929292;
            color: #7d7272;
            text-align: center;
            border-radius: .1rem;
            margin: .5rem 0 .4rem 0rem;
        }

        .back_goo svg {
            width: .6rem;
            height: .6rem;
            vertical-align: middle;
        }

        .back_goo1 {
            width: 2rem;
            height: 1.1rem;
            line-height: 1.1rem;
            border: 1px solid #1890FF;
            color: #ffffff;
            text-align: center;
            background: #1890FF;
            border-radius: .1rem;
            margin: .5rem 0 .4rem .2rem;
        }

        .back_goo1 svg {
            width: .4rem;
            height: .4rem;
            vertical-align: middle;
        }

        .cont_opricect a {
            display: inline-block;
            width: 25px;
            height: 25px;
            margin: 0 .2rem;
            vertical-align: middle;
        }

        .cont_opricect a svg {
            width: 100%;
            height: 100%;
        }

        .cont_opricect input {
            vertical-align: middle;
            width: 1.5rem;
            height: .5rem;
            text-align: center;
            line-height: .5rem;
        }

        .mt_tdaz {
            display: inline-block;
            width: .45rem;
            height: .45rem;
            margin: .3rem 0;
        }

        .mt_tdaz img {
            width: 100%;
        }

        .query-module {
            width: 65%;
            padding: 0 .3rem .3rem .3rem;
            margin: .3rem .3rem .3rem 0;
            float: right;
            border-radius: .05rem;
            box-shadow: 1px 1px 4px 1px #d6d3d3;
        }

        .query-form {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .query-form .form-item {
            margin-bottom: 0px;
            margin-left: 10px;
            margin-top: .3rem;
        }

        .query-btn .btn-item .btn-sais {
            background: #0078FF;
            border-color: #0078FF;
            color: #ffffff;
        }

        .table th,
        .table td {
            font-size: 0.3rem;
        }
        .caption {
    text-align: left;
    font-size: .37rem;
    margin-top: .4rem;
    height: 1rem;
    line-height: 1rem;
    margin-bottom: .3rem;
}
.cell-operate a{display: inline-block;width: 40px;text-align: center;font-size: .3rem;margin-right: 15px;}
.query-form .form-item font {
    float: left;
    width: 65px;
    padding-top: 4px;
    position: relative;
}
.query-form .form-item .element {
    margin-left: 65px;
    height: auto;
    min-height: 26px;
    _height: 26px;
}
    </style>
</head>

<body>
    <div class="outdiv">
        <div class="left" id="left">
            <!--#include file="left.html"-->
        </div>
        <div class="right_conter">
            <div class="header_box" id="header">
                <!--#include file="header.html"-->
            </div>
            <div class="h8vh"></div>
            <div style="width: auto;margin: 0;">

                <div class="query-module">
                    <div class="query-form">
                        <div class="form-item">
                            <font>问诊编号</font>
                            <div class="element">
                                <div class="element-text">
                                    <input type="text" id="k" value="">
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <font>问诊人名称</font>
                            <div class="element">
                                <div class="element-text">
                                    <input type="text" id="amount" value="">
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="query-btn">
                                <div class="btn-item"> <a class="btn-sais" id="J_query" style="padding-left: 15px;">
                                        <svg style="width:20px;height:20px;vertical-align: middle;" t="1607394598323"
                                            class="icon" viewBox="0 0 1024 1024" version="1.1"
                                            xmlns="http://www.w3.org/2000/svg" p-id="2669" width="48" height="48">
                                            <path
                                                d="M874.666667 814.933333l-209.066667-209.066666C704 554.666667 725.333333 494.933333 725.333333 426.666667c0-166.4-132.266667-298.666667-298.666666-298.666667s-298.666667 132.266667-298.666667 298.666667 132.266667 298.666667 298.666667 298.666666c68.266667 0 128-21.333333 179.2-59.733333l209.066666 209.066667c17.066667 17.066667 42.666667 17.066667 59.733334 0s17.066667-42.666667 0-59.733334zM426.666667 640c-119.466667 0-213.333333-93.866667-213.333334-213.333333s93.866667-213.333333 213.333334-213.333334 213.333333 93.866667 213.333333 213.333334-93.866667 213.333333-213.333333 213.333333z"
                                                fill="#ffffff" p-id="2670"></path>
                                        </svg>
                                        搜索
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div class="data-content">
                    <div class="tb-container" style="height: 70vh;overflow: auto;" id="tb-containers">
                        <table class="table" id="rstb">
                            <caption class="caption">问诊列表</caption>
                            <thead>
                                <tr align="center">
                                    <th><strong class="tb-head cell-orderid" data-val="orderid">序号</strong></th>
                                    <th><strong class="tb-head cell-username" data-val="username">姓名</strong></th>
                                    <th><strong class="tb-head cell-product" data-val="product">年龄</strong></th>
                                    <th><strong class="tb-head cell-amount" data-val="amount">性别</strong></th>
                                    <th><strong class="tb-head cell-pay_channel" data-val="pay_channel">问诊时间</strong></th>
                                    <th><strong class="tb-head cell-pay_amount" data-val="pay_amount">问诊编号</strong></th>
                                    <th style="width: 15%;"><strong class="tb-head cell-operate"
                                            data-val="operate">操作</strong>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="datas" data-page="1" data-loaded="0">
                                <!-- <tr align="center">
                              <td>1113454654654</td>
                              <td>张三</td>
                              <td>2020-02-03</td>
                              <td>2</td>
                              <td>233.5</td>
                              <td>张主卧</td>
                              <td>春雨</td>
                              <td>
                                <a href="#" class="mt_tdaz"><img src="/pharmacies/store/images/jiahoass.png"></a>
                              </td>
                          </tr>
                      -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>
        var page = 1;
        checkLogin("golink");
        $(function () {
            document.getElementById('tb-containers').onscroll = function () {
                myscroll();
            };
            var date = new Date();
            $('#st').val(date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate());
            $('#et').val(date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate());
            getData();
            var screenHeight = $(window).height();
            $('.first-container').css({
                height: screenHeight - 93
            });
            var tbWidth = $(window).width() - 245;
            $(".tb-container").css({
                width: tbWidth
            });

            $('#J_query').on('click', function () {
                $('#datas').attr('data-page',1);
                page = 1;
                $('#datas').children('tr').remove();
                getData();
            });
         
        });

        function getData() {
            $('.loading').show();
            var url = '/?m=pharmacy&c=doctor&a=inquirylists&ajax=1';
            page=parseInt($('#datas').attr('data-page'));
            if (1 <= page){
                url += '&page=' + page;
            }else{
                page=1; 
            }
            var query = {};
            var amount = $('#amount').val();
            if (amount) query.amount = amount;
            var k = $.trim($('#k').val());
            if (k) query.k = k;
            var st = $.trim($('#st').val());
            var et = $.trim($('#et').val());
            if (st && et) {
                query.st = st;
                query.et = et;
            }
            request(url, 'get', {
                query: query,
                dataType: "JSONP",
                success: function (data) {
                    console.log(data);
                    if (1 == data.status) {
                        $('.m-empty').hide();
                        $('#datas').attr('data-loaded', 0);
                        $('.loading').hide();
                        var datas = data.rows;
                        if (data.rows.length == 0) {
                            $('#datas').attr('data-loaded', 1);
                        }
                        var html = '';
                        const genRandom = (min, max) => (Math.random() * (max - min + 1) | 0) + min;
                        for (var i in datas) {
                            var info = datas[i];
                            html += '<tr align="center" data-val="' + info.id + '">\
                              <td>' + info.oid + '</td>\
                              <td>' + info.name + '</td>\
                              <td>' + info.ages + '</td>\
                              <td>' + info.sex + '</td>\
                              <td>' + info.created_time + '</td>\
                              <td>' + info.pnid + '</td>\
                              <td class="cell-operate"><a href="#" class="mt_tdaz" data-id="' + info.id +
                                '" data-index="' + i + '">挂断</a><a href="/pharmacies/doctor/interrogation_doc.html?id='+info.oid+'&oid='+genRandom(1,10)+'">接通</a></td>\
                          </tr>';
                        }
                        $('#datas').append(html);

                    } else {
                        if (1 == page) {
                            $('.m-empty').show();
                        } else {
                            $('.loading').hide();
                        }
                    }
                  //  operates(data.rows);
                },
                error: function (res) {
                    console.log(res);
                }
            });
        }
     
        function myscroll() {
            var loaded = parseInt($('#datas').attr('data-loaded'));
            var page = parseInt($('#datas').attr('data-page'));
            var tbcontainers = document.getElementById('tb-containers');
            var datas = document.getElementById('datas');
            if (0 == loaded) {
                //变量scrollTop是滚动条滚动时，距离顶部的距离
                var scrollTop = tbcontainers.scrollTop || datas.scrollTop;
                //var scrollTop = document.getElementById('J_coupon').scrollTop;
                //变量windowHeight是可视区的高度
                var windowHeight = tbcontainers.clientHeight || datas.clientHeight;
                //var windowHeight = document.getElementById('J_coupon').clientHeight;
                //变量scrollHeight是滚动条的总高度
                var scrollHeight = tbcontainers.scrollHeight || datas.scrollHeight;
                //var scrollHeight = document.getElementById('datas').scrollHeight;
                //console.log(scrollTop+'**'+windowHeight+'**'+scrollHeight);return;
                if (scrollTop + windowHeight == scrollHeight) {
                    page++;
                    $('#datas').attr('data-loaded', 1);
                    $('#datas').attr('data-page', page);
                    window.setTimeout("getData()", 300);
                }
            }
        }
    </script>
</body>

</html>
