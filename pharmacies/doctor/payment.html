<!DOCTYPE html>
<html lang="cn">
<head>
<meta charset="UTF-8">
<meta name="viewport"
        content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<link rel="stylesheet" type="text/css" href="/statics/css/app/appstyle.css">
<link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/header_common.css?v=124">
<link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/left_.css?v=125">
<link rel="stylesheet" type="text/css" href="/pharmacies/doctor/css/index.css">
<link rel="stylesheet" href="/statics/dataManage/css/bootstrap.css">
<script type="text/javascript" src="/statics/js/setFontSize.js"></script>
<script type="text/javascript" src="/statics/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/statics/js/global.js"></script>
<script src="/statics/public/js/public.js?v=234"></script>
<title>处方单</title>
<style>
 .query-btn .btn-item {
    margin-left: 0px;
}
.query-btn .btn-item {
    height: auto;
    min-height: 26px;
}
.query-btn .btn-item {
    height: auto;
    min-height: 26px;
    text-align: center;
}
.gethome{    
    width: 97%;
    height: .7rem;
    line-height: .7rem;
    margin: .3rem auto 0 auto;}
.gethome svg{float:right;width: .5rem;height: .5rem;vertical-align: middle;}
.gethome span{float: right;
    margin-left: .05rem;vertical-align: middle;
    color: #836be0;}


    
.data-content {    
     overflow: hidden;
    width: 93%;
    padding: 1rem 0 1.5rem 0;
    margin: .8rem auto;
    border-radius: .05rem;
    box-shadow: 0px 1px 3px 1px transparent; }
.ct-prescription {margin: 0 auto;
    width: 93%;
    background-color: #fff;
    padding: 35px;
    box-shadow: 0px 0px 34px 1px #bfdeff;
    border-radius: 10px;
    box-sizing: border-box; }
.prescription-tool { height: 32px; margin: 0 20px; }
.prescription-tool .tool-item { padding: 0 15px; background-color: #2c8df2; float: right; margin-left: 5px; height: 32px; line-height: 32px; border-radius: 5px; text-align: center; color: #fff; font-size: 12px; cursor: pointer; }
.prescription-data .data-head { margin: 10px 0; height: 20px; line-height: 20px; border-left: 5px solid #2c8df2; padding-left: 15px; font-size: 15px; color: #2c8df2; }
.data-table { border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; position: relative; margin-bottom: 0; overflow: hidden; }
.data-table.tbody { margin-top: -1px; }
.prescription-col-0, .prescription-col-1, .prescription-col-10, .prescription-col-11, .prescription-col-12, .prescription-col-13, .prescription-col-14, .prescription-col-15, .prescription-col-16, .prescription-col-17, .prescription-col-18, .prescription-col-19, .prescription-col-2, .prescription-col-20, .prescription-col-21, .prescription-col-22, .prescription-col-23, .prescription-col-24, .prescription-col-3, .prescription-col-4, .prescription-col-5, .prescription-col-6, .prescription-col-7, .prescription-col-8, .prescription-col-9 { float: left; }
.prescription-col-2 { width: calc(100%/24*2);
}
.prescription-col-3 { width: calc(100%/24*3);
}
.prescription-col-4 { width: calc(100%/24*4);
}
.prescription-col-6 { width: calc(100%/24*6);
}
.prescription-col-7 { width: calc(100%/24*7);
}
.prescription-col-8 { width: calc(100%/24*8);
}
.prescription-col-10 { width: calc(100%/24*10);
}
.prescription-col-20 { width: calc(100%/24*20);
}
.prescription-col-21 { width: calc(100%/24*21);
}
.data-table>div { padding: 0 0 0 5px; line-height: 30px; color: #485060; font-size: 13px; height: 30px; box-sizing: border-box; background-color: #f9f9f9; border: 1px solid #ddd; border-right: none; border-bottom: none; }
.data-state { position: absolute; top: 35px; right: 5px; border: 2px dotted #ffa710; color: #ffa710; padding: 0 10px; height: 33px; line-height: 29px; transform: rotate(30deg); -ms-transform: rotate(30deg); -o-tranform: rotate(30deg); -webkit-transform: rotate(30deg); -moz-transform: rotate(30deg); }

.back_goo{    width: 3.5rem;
    height: .9rem;
    line-height: .9rem;
    border: 1px solid #929292;
    color: #7d7272;
    text-align: center;
    border-radius: .1rem;
    margin: .8rem 0 .2rem 1.5rem;}
.back_goo svg{width: .6rem;height: .6rem;vertical-align: middle;}
.prescription-tool .tool-itemsed {
    padding: 0 30px;
    background-color:rgb(236, 92, 92);
    float: right;
    margin-left: 5px;
    height: 32px;
    line-height: 32px;
    border-radius: 5px;
    text-align: center;
    color: #fff;
    font-size: 12px;
    cursor: pointer;
}
</style>
</head>
<body>
   <div class="outdiv">
      <div class="left" id="left">
          <!--#include file="left.html"-->
      </div>
       <div class="right_conter">
           <div style="width:auto;margin:auto;">
            <!-- <div class="back_goo" onclick="goo('/pharmacies/store/distribution.html')">
                <svg t="1607408152481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3504" width="48" height="48"><path d="M438.4 297.6c12.8 12.8 12.8 28.8 3.2 41.6l-3.2 3.2L300.8 480H800c19.2 0 32 12.8 32 32 0 16-12.8 28.8-28.8 32H300.8l137.6 137.6c12.8 12.8 12.8 28.8 3.2 41.6l-3.2 3.2c-12.8 12.8-28.8 12.8-41.6 3.2l-3.2-3.2-192-192-3.2-3.2-3.2-3.2-3.2-3.2V499.2l3.2-3.2 3.2-3.2 3.2-3.2 192-192c12.8-12.8 32-12.8 44.8 0z" fill="#bfbfbf" p-id="3505"></path></svg>
                返回处方列表
            </div> -->
            <div class="back_goo" onclick="goo('/pharmacies/doctor/doc_ption_list.html')">
              <svg t="1607408152481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3504" width="48" height="48"><path d="M438.4 297.6c12.8 12.8 12.8 28.8 3.2 41.6l-3.2 3.2L300.8 480H800c19.2 0 32 12.8 32 32 0 16-12.8 28.8-28.8 32H300.8l137.6 137.6c12.8 12.8 12.8 28.8 3.2 41.6l-3.2 3.2c-12.8 12.8-28.8 12.8-41.6 3.2l-3.2-3.2-192-192-3.2-3.2-3.2-3.2-3.2-3.2V499.2l3.2-3.2 3.2-3.2 3.2-3.2 192-192c12.8-12.8 32-12.8 44.8 0z" fill="#bfbfbf" p-id="3505"></path></svg>
              返回处方列表
          </div>
            <div class="data-content">
              <div class="ct-prescription" >
                <div class="ct-prescription-content">
                  <div class="prescription-tool">
                    <!--<div nz-button="" nztype="primary" class="tool-item chargeback">退单</div>-->
                    <!-- <div nz-button="" nztype="primary" class="tool-itemsed toPrint" id="J_sh" style="display: none;">审核</div> -->
                    <div nz-button="" nztype="primary" class="tool-item toOrdonnance" id="J_notes">查看处方笺</div>
                  </div>
                  <!--prescription-tool-->
                  <!--startPrint-->
                  <div class="prescription-data" id="J_print_prescription">
                    <div class="data-head">处方信息</div>
                    <div nz-row="" class="data-table"> <!-- 第一行 -->
                      <div class="prescription-col-4">处方单号:</div>
                      <div class="prescription-col-8" id="prescription_no"></div>
                      <div class="prescription-col-4">支付状态:</div>
                      <div class="prescription-col-8" id="pays"> </div>
                      <!-- 第二行 -->
                      <div class="prescription-col-4">取药方式:</div>
                      <div class="prescription-col-8">到店</div>
                      <div class="prescription-col-4">订单支付时间:</div>
                      <div class="prescription-col-8"><span class="noValue no-print" id="pay_time"></span></div>
                      <!-- 第三行 -->
                      <div class="prescription-col-4">审核状态:</div>
                      <div class="prescription-col-20">
                          <span id="examine">---</span>
                          <div class="data-state" id="examineicon">---</div>
                      </div>
                    </div>
                    <!--data-table--->
                    <div class="data-head">患者信息</div>
                    <div nz-row="" class="data-table"> <!-- 第一行 -->
                      <div class="prescription-col-4">姓名:</div>
                      <div class="prescription-col-8" id="name"> --</div>
                      <div class="prescription-col-4">联系电话:</div>
                      <div nz-col="" class="prescription-col-8" id="mobile">---</div>
                    </div>
                    <!--data-table--->
                    <div class="data-head">药品信息</div>
                    <div class="data-table" id="drug-msg"> <!-- 第一行 -->
                      <div class="prescription-col-3">序号</div>
                      <div class="prescription-col-7">药品名称</div>
                      <div class="prescription-col-4">药商药品编码</div>
                      <div class="prescription-col-2">数量</div>
                      <div class="prescription-col-4">单价（元）</div>
                      <div class="prescription-col-4">价格（元）</div>
                    </div>
                    <div id="tobody">
 
                    </div>
                    <!-- <div class="data-table tbody">
                        <div class="prescription-col-3">1</div>
                        <div class="prescription-col-7">达比加群酯胶囊（合资）</div>
                        <div class="prescription-col-4">2</div>
                        <div class="prescription-col-2">0</div>
                        <div class="prescription-col-4">172.10</div>
                        <div class="prescription-col-4">172.10</div>
                      </div> -->
                      <!-- <div class="data-table tbody">
                        <div class="prescription-col-3">2</div>
                        <div class="prescription-col-7">丁苯酞软胶囊（国产）</div>
                        <div class="prescription-col-4">5</div>
                        <div class="prescription-col-2">0</div>
                        <div class="prescription-col-4">189.60</div>
                        <div class="prescription-col-4">189.60</div>
                      </div> -->
                    <div class="data-table tbody">
                      <div class="prescription-col-3">总价</div>
                      <div class="prescription-col-21" id="total"><?php echo $datas['drug_money']?></div>
                    </div>
                    <!--data-table--->
                    <div class="data-head">物流信息</div>
                    <div nz-row="" class="data-table">
                      <div class="prescription-col-4">收件人地址:</div>
                      <div class="prescription-col-20" id="address"></div>
                      <div class="prescription-col-4">物流信息:</div>
                      <div class="prescription-col-20"></div>
                    </div>
                    <!--data-table--->
                    <!--<div class="data-head">订单记录</div>
                    <div nz-row="" class="data-table">
                      <div class="prescription-col-6"><span class="noValue no-print">0000-00-00 00:00:00</span></div>
                      <div class="prescription-col-4">发药</div>
                      <div class="prescription-col-4">东莞</div>
                      <div class="prescription-col-10">508</div>
                      
                      <div class="prescription-col-6"><span class="noValue no-print">0000-00-00 00:00:00</span></div>
                      <div class="prescription-col-4">审核处方</div>
                      <div class="prescription-col-4">阿萨</div>
                      <div class="prescription-col-10">审核结果：通过</div>
                    </div>-->
                    <!--data-table---> 
                  </div>
                  <!--prescription-data---> 
                  <!--endPrint-->
                </div>
              </div>
            </div>
            <!---data-content end--> 
          </div>
       </div>
   </div>   
   <script>
    var page = 1;
    var prescription_no = getQueryString('prescription_no');
    $(function(){
      getData();
      $('#J_sh').click(function (){
        goo('/pharmacies/store/review_p.html?&prescription_no='+prescription_no);
      })
      $('#J_notes').click(function (){
        goo('/pharmacies/doctor/prescriptionNotes.html?&prescription_no='+prescription_no);
      })
    });
    function getData(){
      var url = '/?m=pharmacy&c=prescription&a=detail&ajax=1';
      var query = {prescription_no:prescription_no};//查询参数
      request(url,'get',{
          query: query,
          dataType:"JSONP",
          success:function(res){
            console.log(res);
            var row = res.data.row;  //处方
            $('#prescription_no').text(row.prescription_no);
            row.pay_time=row.pay_time==0?'---':row.pay_time;
            $('#pay_time').text(row.pay_time);
            $('#name').text(row.full_name);
            if(row.mobile)$('#mobile').text(row.mobile);
            $('#examine').text(row.status_str);
            $('#examineicon').text(row.status_str);
            $('#pays').text(row.pay_status_str);
            $('#address').text(row.address);
            // if(row.status=='WAIT_VERIFY'){
            //   $('#J_sh').show();
            // }
            var drug = res.data.drug;
            var html = '';
            var total=0;
            if (0<Object.keys(drug).length) {
              for(var k in drug){
                  var info = drug[k];
                  var num=Number(k)+1;
                  html += '<div class="data-table tbody">\
                        <div class="prescription-col-3">'+num+'</div>\
                        <div class="prescription-col-7">'+info.drug_name+'</div>\
                        <div class="prescription-col-4">'+info.prescription_no+'</div>\
                        <div class="prescription-col-2">'+info.drug_quantity+'</div>\
                        <div class="prescription-col-4">'+info.drug_price+'</div>\
                        <div class="prescription-col-4">'+info.drug_sub_price+'</div>\
                      </div>';
                  total+=parseFloat(info.drug_sub_price);
              }
            } else {
              html += '<tr align="center"><td colspan="'+($('.tb-head').length)+'">暂无数据</td></tr>';
            }
            $('#tobody').html(html);
            $('#total').text(total);
          },
          error:function(res){
              console.log(res);
          }
      });
    }
    </script>
</body>
</html>