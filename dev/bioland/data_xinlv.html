<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="topcolor" rgba="44.172.252.1">
<link rel="stylesheet" type="text/css" href="/statics/css/app/appstyle.css">
<link rel="stylesheet" type="text/css" href="/statics/css/app/header_common.css">
<title>心率检测</title>
<link rel="stylesheet" type="text/css" href="/statics/js/layer/1.9.3/skin/layer.css">
<link rel="stylesheet" type="text/css" href="statics/css/style.css">
<script type="text/javascript" src="/statics/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/statics/js/global.js"></script>
<script type="text/javascript" src="/statics/js/layer_mobile/layer.js"></script>
<script type="text/javascript" src="/statics/js/setFontSize.js"></script>
<script type="text/javascript" src="/statics/languages/20181105/languages.js"></script>
</head>
<style>
body { background-color: #f8f8f8; }
.xueya_pro { width: 80%; overflow: hidden; margin: 6% auto 4% auto; }
.xueya_pro .xueya_day { width: 100%; overflow: hidden; border: 1px solid #317ce2; border-radius: 20px; }
.xueya_day li { width: 33.3%; float: left; text-align: center; height: 35px; line-height: 35px; background-color: #317ce2; color: #fff; border-right: 1px solid #317ce2; }
.xueya_day li:last-child { border-right: none; }
.xueya_day .active { background-color: #fff; color: #317ce2; }
/**/

.xueya_pro_big { width: 100%; overflow: hidden; background-color: #fff; }
.xueya_pic { width: 85%; overflow: hidden; position: relative; margin: 10px auto 0 auto; }
.xueya_pic .pic { width: 100%; }
.xueya_pic .xueya_pic_ { width: 27%; overflow: hidden; position: absolute; top: 50%; left: 30%; transform: translate(-50%, -50%); -webkit-transform: translate(-50%, -50%); }
.xueya_pic .xueya_pic_ .num { font-size: 1.4rem; }
.xueya_pic .xueya_pic_ span { font-size: 1rem; margin-left: 5px; line-height: 24px; }
.xueya_pic_ .num_xl { width: 40%; float: right; }
.xueya_pic_ .num_xl img { width: 43%; }
.xueya_pic_ .num_xy { width: 100%; overflow: hidden; }
.xueya_pic_ .num_xy_h { width: 54%; }
.xueya_pic_ .num_xy_h img { width: 28%; float: left; margin-right: 0.3%; }
.xueya_pic_ .num_xy_l { width: 36%; }
.xueya_pic_ .num_xy_l img { width: 50%; }
.xueya_pro .status { width: 100%; height: 30px; line-height: 30px; text-align: center; font-size: .9rem; color: #979696; margin-bottom: 5px; }
.xueya_pro .status span { font-size: 1.2rem; }
.xueya_more { width: 100%; overflow: hidden; }
.xueya_more .more { width: 45%; height: 40px; line-height: 40px; text-align: center; border-radius: 5px; }
.xueya_more .more img { vertical-align: sub; width: 20px; margin-right: 5px; }
.xueya_more .more:first-child { background-color: #2a8cd5; color: #fff; }
.xueya_more .bind_b { border: 1px solid #2a8cd5; color: #2a8cd5; }
/*数据记录*/

.explain { width: 100%; height: 35px; line-height: 35px; background-color: #f4f4f4; padding: 0px 3%; color: #565656; }
.explain img { width: 20px; margin-right: 5px; vertical-align: sub; }
.xueya_data { width: 100%; overflow: hidden; background-color: #fff; padding: 0px 2%; }
.xueya_data .title { width: 100%; height: 44px; line-height: 44px; text-align: center; color: #808080; }
.xueya_data .data_box, .data_line { width: 100%; overflow: hidden; }
.xueya_data .data_line { border-top: 1px solid #e3e3e7; padding: 7px 3px 5px 26px; }
.xueya_data .data_line td { padding: 8px 0px; }
.xueya_data .line_1 span { color: #666; }
.line_1 { width: 36%; display: inline-block; }
.line_1 .line_1_p { background-color: #2cacfc; text-align: center; color: #fff; font-size: .9rem; border-radius: 3px; height: 22px; line-height: 18px; display: inherit; padding: 2px 10px; }
.line_2 { width: 22%; display: inline-block; top: -14px; position: relative; }
.line_3 { width: 29%; display: inline-block; color: #2cacfc; text-align: center; position: relative; top: -12px; text-align: right; }
.line_4 { width: 20%; display: inline-block; text-align: right; }
.t_ext { color: #fff !important; }
.zhengchang { background-color: #f6ab48; width: 90%; margin: 0 auto; color: #fff; font-size: .8rem; text-align: center; border-radius: 3px; height: 25px; line-height: 25px; }
	.bg{ top:0;}
	.header_box .midden {
    border-bottom: 1px solid #e6e6e6;
}
</style>
<script>

function getCookie2(name) {

	var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");

	if (arr = document.cookie.match(reg))

	return decodeURIComponent(arr[2]);

	else return null;

}

var userid = getCookie2('GkvUY___userid');

if(getUrlParam('weixin') == 1 && !userid){

	$('body').hide();

	goo('/?m=member&c=data_temp&a=go_login&forward='+encodeURIComponent(window.location.href));

}

</script>

<body>
<iframe src="" style="display: none;width: 80%;height: 100%;z-index: 100;right: 0;position: absolute; transition: right .2s" frameborder="0" scrolling="no" id='iframeView'></iframe>
<div class="header_box"> <img src="/statics/images/goback_b.png" onClick="goback()" class="left">
  <p class="midden">心率数据</p>
  <div class="right_" onClick="goo('http://shop.yjxun.cn/')">去商城购买</div>
</div>
<div class="h50"></div>
<div>
  <div class="xueya_pro_big">
    <div class="xueya_pro">
      <div class="xueya_day">
        <ul>
          <li onClick="goo('/medical/data_xinlv.html?day=1&to_uid=0')">今天</li>
          <li class="active" onClick="goo('/medical/data_xinlv.html?day=1&to_uid=0')">最近7天</li>
          <li class="active" onClick="goo('/medical/data_xinlv.html?day=1&to_uid=0')">最近30天</li>
        </ul>
      </div>
      <div class="xueya_pic"> <img src="statics/images/xinlv_top.png" class="pic"> 
        
        <!--<div class="xueya_pic_">

                  <div class="num"><span>心率</span>&nbsp;<div class="num_xl"><img src="statics/images/xueya_1.png"><img src="statics/images/xueya_2.png"></div></div>

                  <div class="num"><span>血压</span></div>

                  <div class="num">

                  	<div class="num_xy">

                    	<div class="num_xy_h fl">

                        	<img src="statics/images/xueya_1.png"><img src="statics/images/xueya_2.png"><img src="statics/images/xueya_0.png">

                        </div>

                        <div class="num_xy_l fr">

                        	<img src="statics/images/xueya_1.png"><img src="statics/images/xueya_2.png">

                        </div>

                    </div>

                  </div>

              </div>--> 
        
      </div>
      <div class="xueya_more" style="display:">
        <div class="more fl" onClick="showright()"><img src="statics/images/write.png" ><u set-lan="html:manual_entry">开始测量</u></div>
        <div class="more fr bind_b" onClick="show_write_more()" id="bind_b"><img src="statics/images/binding.png"><u set-lan="html:binding_device">手工录入</u></div>
		 <script>
		 	function showright(){
				if(isWeiXin()){
					$('#iframeView').attr('src','/equipment/equipment_list3.html?mobile='+getQueryString('mobile'));
					$('#iframeView').css('right',-1 * 82 + 'vw');
					$('#iframeView').show();
					$('.bg').show();
					window.setTimeout(function(){ $('#iframeView').css('right','0');} , 30);
				}else{
					goo('/equipment/equipment_list3.html?mobile='+getQueryString('mobile'));
				}
			}
		 </script>
      </div>
    </div>
  </div>
  <div class="xueya_data">
    <p class="title">数据记录</p>
    <span id="insert_bp"></span> </div>
</div>
<div class="bg"></div>
<div id="template" class="template">
  <div class="data_line">
    <div class="line_1">
      <p class="line_1_p"><span class="t_ext"></span></p>
      <p><span class="day"></span><span class="time"></span></p>
    </div>
    <div class="line_2">
      <p class="zhengchang">血压正常</p>
    </div>
    <div class="line_3">心率:<span class="t_bp_rate">-</span></div>
    
    <!--<div class="line_4">

              <p style="color:#2cacfc;">高压:<span class="t_high">-</span></p>

              <p style="color:#f6ab48;">低压:<span class="t_low">-</span></p>

          </div>--> 
  </div>
</div>
<div class="write_more">
  <div class="write_more_down" onClick="hide_write_more()"> <img src="statics/images/down.png" /> </div>
  <div class="write_box">
    <div class="write_box_">
      <div class="write_box_l fl"><img src="statics/images/heart_red.png"><u set-lan="html:heart_rate">心率</u></div>
      <input class="write_box_m fl" id="m_hrRate" type="number" placeholder="手工输入数据">
      <div class="write_box_r fl">bpm</div>
    </div>
    <div class="save" onClick="write_save()" set-lan="html:save">确认保存</div>
  </div>
</div>
</body>
</html>
<script> 
var userid_;
$(function(){

	$.ajax({

		url:"http://www.yjxun.cn/?m=member&c=data&a=set_ss_encode",

		data:"",

		success:function(daa){

			userid_ = daa;

			if(!userid_){

				layer.open({

					shadeClose: false,

					content: '您还未登录医家讯账号？'

					,btn: ['立即前往']

					,yes: function(index){

						goo('http://www.yjxun.cn/member/login.html?forward='+encodeURIComponent(window.location.href));

						layer.close(index);

					}

				});

			}

			get_today();

		}

	})

})
get_today();
setInterval(function(){

	get_today();

},8000)

$('.bg').css('height',window.screen.height); //-50

function show_write_more(){

  $('.write_more').css("bottom",0-$('.write_more').height()-200);

  $('.write_more').show();

  window.setTimeout(function(){

    $('.write_more').css({'transition':'all .5s',"bottom":0});

    $('.bg').fadeIn(300);

    $('#m_bpHp').focus();

  },30);

}

function hide_write_more(){  

 $('.write_more').css("bottom",0-$('.write_more').height()-200);

  window.setTimeout(function(){

    $('.write_more').css({'transition':'none'});

    $('.write_more').hide();

  },300);

  

  $('.bg').fadeOut(30);

}

function get_today(){

	$.ajax({

		url:'/?m=medical&c=kith&a=get_datas',

		type:'POST',

		data:'judge=5&userid='+userid+'&date_time='+$('#start_t').text(),

		dataType:'json',

		success:function(da){

			$('.xueya_data').html('<p class="title">数据记录</p><span id="insert_bp"></span>');

			var txt = '';

			var data = da.data;

			var a = $('#template');

			for(o in data){

				var num = data[o]['num'];

				var state = '正常';

				/**********************************************************/

				$(a).find('.zhengchang').css('background','#10ca38');

				if(Number(num) >= 160){

					state = '超高';

					$(a).find('.zhengchang').css('background','#f94444');

				}else if(Number(num) >= 110){

					state = '偏高';

					$(a).find('.zhengchang').css('background','#f5a431');

				}else if(Number(num) < 60){

					state = '偏低';

					$(a).find('.zhengchang').css('background','#2cacfc');

				}

				$(a).find('.day').html(o);

				/*$(a).find('.time').html();*/

				$(a).find('.zhengchang').css('background','#10ca38');

				$(a).find('.t_bp_rate').html( num);

				$(a).find('.zhengchang').html( '心率'+state);

				$(a).find('.t_ext').html(data[o].user_str);

				str = $('#template').html() + "";

				$('#insert_bp').before(str);

			}

		}

	})

}

function write_save(){
	$('html,body').scrollTop(0);
	var i = layer.open({
		content: '确定保存此数据？'
		,btn: ['确定', '取消']
		,yes: function(index){
			var hrRate = Number($.trim($('#m_hrRate').val()));			$.ajax({
				url:'//www.yjxun.cn/?m=member&c=data_api&a=measure&userid='+userid_+'&equipment=x9pro&device_name=manual&device_number=1&data='+new Base64().encode('{"hrRate":"'+hrRate+'"}'),
				data:'',
				success:function(daa){
					hide_write_more();
					$('#m_hrRate').val("");
					var timestamp1 = Date.parse( new Date())/1000;
					location.reload();
				}
			})
		}
	});
}

$('.setuser').on("click",function(){

  $(this).addClass('cur').siblings('.setuser').removeClass('cur');

  $('#m_suser').val( $(this).data('val'));

  $('#m_bpHp').focus();

});

function timestampToTime(timestamp) {

	var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000

	Y = date.getFullYear() + '-';

	M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';

	D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate() + ' ';

	h = date.getHours() + ':';

	m = date.getMinutes() + ':';

	s = date.getSeconds();

	return Y+M+D+' '+h+m+s;

}
$('.bg').click(function(){
	$('.write_more').hide();
	$('.bg').hide();
	$('#iframeView').hide();
})
</script>